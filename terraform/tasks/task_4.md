# Terraform

_Для подобного рода задач заводится таска в Jira (вкратце в описании описывается план проведения работ, выставляется время проведения работ, указывается исполнитель и ответственный), прикладывается документация в формате `.docx`, где прописано построчно, что будет происходить, и что делать в случае сбоя (откат). То есть вот вам еще одна строчка в резюме - придумайте, как её красиво расписать._

## **Task 4**

### Подготовка к плавному переходу в репозиторий Ansible

#### Разворачивание инфраструктуры мониторинга на три контура: DEV, STAGING и PROD

1. Нужно подготовить каждый контур для деплоя мониторинга:
    - Это **Ansible** плейбук с [нужными ролями](https://github.com/lamjob1993/ansible-monitoring/blob/main/ansible/tasks/monitoring_project/playbook.yml).
    - Плейбук представлен, как будущий проект, где нужно развернуть по 8 контейнеров на каждом контуре [Ansible: Task_4](https://github.com/lamjob1993/ansible-monitoring/blob/main/ansible/tasks/task_4.md)).
2. Далее нужно самостоятельно написать структуру **Terraform** проекта (почти тоже самое, что и в проекте по заданию 3).
3. В данном проекте на каждом контуре должно быть по 8 пустых контейнеров **Debian**, в которые может ходить Ansible:
    - Нужно жестко прописать на каждый контейнер: `openssh` + `systemd`.
    - Завязать на каждый контейнер уникальный IP.
    - Каждый контур должен быть в своей сети Docker.
4. Инфраструктура подготовлена:
    - Не забываем, что на работе мы используем облако на базе OpenStack (SberInfra, Альфа Cloud, ВТБ Cloud и т.д банки) через провайдер [Terraform OpenStack](https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest) и что для нас контейнеры - это VM-ки либо в облачной терминологии - инстансы).
5. Тем самым **Terraform** раскрывается, как IaC по прямому назначению, то есть разворачивает только инфраструктуру (на 3 контура разработки по 8 подготовленных инстансов) описанную кодом (декларативно):
    - К дальнейшей автоматизации развернутой инфры подключается **Ansible**, как IaC по прямому назначению для работы с конфигурациями (императивно-декларативно). 
5. Сохраняем эту Ubuntu VM-ку и не трогаем.
6. Внимательно читаем раздел: [Модуль 7: Декларативный и императивный стили](https://github.com/lamjob1993/terraform-monitoring/blob/main/terraform/beggining/%D0%9C%D0%BE%D0%B4%D1%83%D0%BB%D1%8C%207%3A%20%D0%94%D0%B5%D0%BA%D0%BB%D0%B0%D1%80%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9%20%D0%B8%20%D0%B8%D0%BC%D0%BF%D0%B5%D1%80%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9%20%D1%81%D1%82%D0%B8%D0%BB%D0%B8.md).
7. Внимательно читаем раздел: [Модуль 8: Пример пайплайна.md](https://github.com/lamjob1993/terraform-monitoring/blob/main/terraform/beggining/%D0%9C%D0%BE%D0%B4%D1%83%D0%BB%D1%8C%208%3A%20%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BF%D0%B0%D0%B9%D0%BF%D0%BB%D0%B0%D0%B9%D0%BD%D0%B0.md).
6. Переходим в начало репозитория Ansible (текущее задание было, как подготовка к [Ansible: Task_4](https://github.com/lamjob1993/ansible-monitoring/blob/main/ansible/tasks/task_4.md)).

---
