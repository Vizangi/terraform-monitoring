# Развернуть test dev и prod контуры (среды) разработки

- Управление инфраструктурой разработки, тестирования и продакшена
- Terraform позволяет создавать одинаковые среды (dev, staging, prod) с минимальными изменениями в коде, обеспечивая консистентность.
- Пример: Настройка идентичных VPC для разных сред с помощью переменных и модулей.

--- 

### 0. Что такое VPC?
VPC (Virtual Private Cloud) — это виртуальная частная сеть в облаке, предоставляемая провайдерами, такими как AWS, Azure или GCP. Она позволяет изолировать ресурсы (серверы, базы данных, сети) в логически обособленной сетевой среде. Основные характеристики VPC:

- Изоляция: Ресурсы внутри VPC недоступны из внешнего интернета или других VPC без явной настройки.
Подсети: VPC делится на подсети (например, публичные для веб-серверов и приватные для баз данных).
Маршрутизация и шлюзы: Управляет трафиком между ресурсами, интернетом и другими сетями.
Безопасность: Поддерживает настройки файрволов (группы безопасности) и ACL (списки контроля доступа).

- В контексте локальной среды (Docker): VPC можно эмулировать с помощью Docker-сетей. Docker-сеть изолирует контейнеры, позволяя им взаимодействовать только внутри заданной сети, что аналогично VPC. Например, вы можете создать сеть для dev, staging и prod, чтобы контейнеры в каждой среде были изолированы.

### 1. В контексте локальной среды (Docker): VPC можно эмулировать с помощью Docker-сетей. Docker-сеть изолирует контейнеры, позволяя им взаимодействовать только внутри заданной сети, что аналогично VPC. Например, вы можете создать сеть для dev, staging и prod, чтобы контейнеры в каждой среде были изолированы.

### 2. Кейс: Управление инфраструктурой dev, staging, prod с Terraform и Docker
- Цель: Настроить три идентичные среды (dev, staging, prod) с помощью Terraform, используя Docker-контейнеры для эмуляции серверов (например, веб-сервер Nginx и база данных PostgreSQL). Каждая среда будет иметь свою изолированную Docker-сеть (аналог VPC) и контейнеры, настроенные с помощью переменных и модулей для консистентности.

### 3. Что будем создавать:
- Docker-сеть для каждой среды (аналог VPC).
- Два контейнера в каждой среде:
- Веб-сервер (Nginx).
- База данных (PostgreSQL).
- Модуль Terraform для повторного использования кода.
- Переменные для настройки различий между средами (например, порты, имена).

### 4. Структура проекта:
```
terraform-docker-course/
├── modules/
│   └── environment/
│       ├── main.tf
│       ├── variables.tf
│       └── outputs.tf
├── dev.tf
├── staging.tf
├── prod.tf
├── variables.tf
└── terraform.tfvars
```
### 5. Базовый образ: Для контейнеров используем образ ubuntu:latest

### 6. [Создание модуля Terraform](https://github.com/lamjob1993/terraform-monitoring/tree/main/terraform/tasks/terraform_project/modules/environment)

- Модуль будет описывать инфраструктуру одной среды (Docker-сеть + контейнеры Nginx и PostgreSQL). Это обеспечит повторное использование кода для dev, staging и prod.

### 7. Настройка окружений (dev, staging, prod)
- Создадим конфигурации для каждой среды, вызывая модуль с разными параметрами.
   - Файл: dev.tf
   - Файл: staging.tf
   - Файл: prod.tf
- Эти файлы вызывают модуль environment с уникальными параметрами для каждой среды:

### 8. Определение глобальных переменных
- Для удобства можно определить переменные в отдельном файле.
   - Файл: variables.tf
- Файл: terraform.tfvars (для задания значений)
