# Terraform

**1. Что такое Terraform?**

Представь, что тебе нужно построить дом. Ты можешь строить его вручную, кирпич за кирпичом, а можешь использовать чертеж, где всё описано: размеры комнат, материалы, расположение окон и дверей.

Terraform — это как раз такой "чертеж" для твоей IT-инфраструктуры (серверов, баз данных, сетей, балансировщиков нагрузки и т.д.). Он позволяет тебе описать всю желаемую инфраструктуру в виде **кода** в специальных конфигурационных файлах. Этот подход называется **Infrastructure as Code (IaC)** — Инфраструктура как Код.

Terraform разработан компанией HashiCorp и является инструментом с открытым исходным кодом.

**2. Для чего нужен Terraform? (Преимущества IaC)**

Использование Terraform (и IaC в целом) дает много преимуществ:

* **Автоматизация:** Вместо того чтобы вручную настраивать серверы и сервисы через веб-интерфейсы или командную строку, ты просто описываешь их в коде, а Terraform сам создает, изменяет или удаляет их.
* **Повторяемость и согласованность:** Описав инфраструктуру один раз, ты можешь легко создавать точно такие же копии окружений (например, для разработки, тестирования, продакшена). Это гарантирует, что все окружения будут одинаковыми, и уменьшает количество ошибок.
* **Версионирование:** Так как твоя инфраструктура описана в коде, ты можешь хранить эти файлы в системе контроля версий (например, Git), отслеживать изменения, откатываться к предыдущим версиям и совместно работать над инфраструктурой, как над обычным программным кодом.
* **Управление изменениями:** Terraform показывает, какие изменения он собирается внести *перед* тем, как их применить. Ты можешь просмотреть план и убедиться, что все правильно.
* **Управление жизненным циклом:** Terraform не только создает ресурсы, но и управляет их изменениями и удалением.
* **Поддержка множества платформ:** Terraform работает с огромным количеством "провайдеров" — это могут быть облачные платформы (AWS, Google Cloud, Azure, Yandex Cloud), системы виртуализации (VMware), платформы контейнеризации (Kubernetes), DNS-сервисы, базы данных и многое другое. Ты можешь управлять разными частями своей инфраструктуры из одного места.

**3. Как пользоваться Terraform (Основные концепции)?**

Работа с Terraform строится вокруг нескольких основных шагов и понятий:

* **Конфигурационные файлы:** Ты пишешь код на специальном языке **HCL (HashiCorp Configuration Language)**. Этот язык декларативный, то есть ты описываешь *что* ты хочешь получить, а не *как* это сделать по шагам. Файлы обычно имеют расширение `.tf`.
* **Провайдеры (Providers):** Это плагины, которые Terraform использует для взаимодействия с API конкретной платформы (например, AWS, Azure, Docker). Ты указываешь в конфигурации, какие провайдеры тебе нужны.
* **Ресурсы (Resources):** Это основные блоки твоей инфраструктуры, которые ты описываешь в коде. Например, виртуальная машина, база данных, сетевой интерфейс, DNS-запись. У каждого ресурса есть свой тип (например, `aws_instance` для EC2 инстанса в AWS) и набор аргументов (параметров).
* **Состояние (State):** Terraform хранит информацию о созданной им инфраструктуре в специальном файле состояния (обычно `terraform.tfstate`). Этот файл нужен, чтобы Terraform знал, какими ресурсами он управляет, и мог планировать изменения. **Важно:** Не редактируй этот файл вручную!
* **Основной рабочий процесс:**
    1.  **`terraform init`**: Инициализирует рабочий каталог. Terraform скачивает необходимые плагины провайдеров, указанные в твоей конфигурации. Этот шаг нужно выполнить один раз для нового проекта или после добавления нового провайдера.
    2.  **`terraform plan`**: Terraform сравнивает твою конфигурацию с текущим состоянием (из файла `terraform.tfstate`) и реальной инфраструктурой. Затем он создает план выполнения — список действий (создать, изменить, удалить), которые нужно выполнить, чтобы привести инфраструктуру в соответствие с твоей конфигурацией. Этот шаг безопасен, он ничего не меняет.
    3.  **`terraform apply`**: Terraform выполняет действия, предложенные в плане. Он запросит подтверждение перед внесением изменений (если только ты не используешь флаг `-auto-approve`).
    4.  **`terraform destroy`**: Удаляет всю инфраструктуру, управляемую Terraform в данном проекте (описанную в конфигурации и зафиксированную в файле состояния). Тоже запросит подтверждение.

**4. Как установить и запустить Terraform на Debian?**

1. Качаем бинарь Terraform с [официального сайта](https://developer.hashicorp.com/terraform/install#linux) 
    - `curl -O https://releases.hashicorp.com/terraform/1.11.4/terraform_1.11.4_linux_amd64.zip`
2. Ставим архиватор unzip - `sudo apt install unzip`
    - `unzip terraform_YOUR_VERSION_linux_amd64.zip`
2. Кладем в `/usr/local/bin` и назначаем права +x, если не назначены
    - `sudo cp terraform /usr/local/bin/`
3. Проверяем в консоли (terraform автоматом будет доступен в системе)
    - `terraform version`

Теперь Terraform установлен и готов к работе!

**Первые шаги:**

Чтобы начать, создай новую папку для своего проекта, например `terraform-hello`. Внутри создай файл с именем `main.tf` (или любым другим именем с расширением `.tf`).

**Пример простого `main.tf` (создание локального файла):**

```hcl
# Указываем, что будем использовать провайдер "local"
# для работы с локальными файлами.
terraform {
  required_providers {
    local = {
      source = "hashicorp/local"
      version = "2.1.0" # Укажите актуальную версию, если нужно
    }
  }
}

# Описываем ресурс: локальный файл
resource "local_file" "hello" {
  # Имя файла, который будет создан
  filename = "${path.module}/hello.txt"
  # Содержимое файла
  content  = "Привет от Terraform!"
}

# Опционально: выводим путь к созданному файлу после применения
output "file_path" {
  value = local_file.hello.filename
}
```

**Как запустить этот пример:**

1.  Перейди в папку `terraform-hello` в терминале.
2.  Выполни `terraform init`. Terraform скачает провайдер `local`.
3.  Выполни `terraform plan`. Ты увидишь, что Terraform планирует создать один ресурс (`local_file.hello`).
4.  Выполни `terraform apply`. Подтверди действие, введя `yes`. Terraform создаст файл `hello.txt` в текущей папке с указанным содержимым. Ты также увидишь вывод `file_path`.
5.  Чтобы удалить созданный файл, выполни `terraform destroy`. Подтверди действие.

Это очень простой пример, но он показывает основной цикл работы с Terraform. Обычно ты будешь описывать гораздо более сложные вещи: серверы в облаке, сети, базы данных и т.д., используя соответствующие провайдеры (AWS, GCP, Azure и т.д.).
