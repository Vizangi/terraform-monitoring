# Модуль 2: Основы работы с Terraform

## Теория

### Основные команды Terraform

Terraform предоставляет несколько ключевых команд для управления инфраструктурой:

* **`terraform init`**: Инициализирует рабочий каталог, загружая необходимые плагины и провайдеры. Это первый шаг перед выполнением других команд.
* **`terraform plan`**: Создает план изменений, показывая, что будет сделано при применении конфигурации. Это позволяет увидеть, какие ресурсы будут созданы, изменены или удалены.
* **`terraform apply`**: Применяет изменения, описанные в конфигурации. После выполнения этой команды Terraform начнет создавать или изменять ресурсы в соответствии с планом.
* **`terraform destroy`**: Удаляет все ресурсы, управляемые текущей конфигурацией. Это полезно для очистки ресурсов после завершения работы.

### Управление состоянием

Terraform хранит информацию о текущем состоянии инфраструктуры в файле `terraform.tfstate`. Этот файл необходим для отслеживания изменений и синхронизации состояния между реальной инфраструктурой и конфигурацией. Файл состояния может храниться локально или удаленно, например, в MinIO, которое предоставляет S3-совместимый API и может быть развернуто локально.

### Переменные и Outputs

* **Переменные** позволяют параметризовать конфигурацию, делая её более гибкой. Они определяются с использованием директивы `variable` в конфигурационных файлах Terraform. Вы указываете имя переменной и, по желанию, её тип и описание.
* **Outputs** используются для вывода информации о созданных ресурсах, например, IP-адреса или идентификаторы. Они определяются с использованием директивы `output` и позволяют передавать информацию из модуля или конфигурации наружу.

### Структура файлов Terraform

Рекомендуется организовывать файлы Terraform следующим образом:

```
.
├── main.tf        # Основная конфигурация
├── variables.tf   # Определение переменных
├── outputs.tf     # Определение выводов
├── terraform.tfvars # Значения переменных
```

В этой структуре:

* **`main.tf`**: содержит основную конфигурацию, включая провайдеров и ресурсы.
* **`variables.tf`**: содержит определения переменных, которые используются в конфигурации.
* **`outputs.tf`**: содержит определения выходных значений, которые могут быть использованы другими модулями или для вывода информации пользователю.
* **`terraform.tfvars`**: содержит значения переменных, которые могут быть использованы для настройки конфигурации.

### Рекомендации

* **Использование переменных**: всегда используйте переменные для параметризации конфигурации. Это делает её более гибкой и позволяет легко адаптировать её под различные окружения.
* **Структурирование файлов**: разделяйте конфигурацию на несколько файлов для улучшения читаемости и поддерживаемости. Например, определение провайдеров можно вынести в отдельный файл `providers.tf`.
* **Использование выходных значений**: определяйте выходные значения для передачи информации между модулями или для вывода полезной информации пользователю.

